@model ISKI.SARS.WebUI.Common.ViewModels.ReportTemplateListResponse
@{
    ViewData["Title"] = "Yeni Rapor Oluştur";
    var nameFilter = ViewBag.NameFilter as string;
    var startDate = ViewBag.StartDate as string;
    var endDate = ViewBag.EndDate as string;
    var sortField = ViewBag.SortField as string;
    var sortDirection = ViewBag.SortDirection as string;
}

<div class="w-full h-[calc(100vh-64px)] px-10 py-8 bg-[#dcecff]">
    <div class="bg-white p-10 rounded shadow-md w-full max-w-6xl">
        <h2 class="text-3xl font-bold text-blue-700 mb-6 flex items-center gap-2">
            <span>📄</span> Yeni Rapor Oluştur
        </h2>

        <form method="get" class="mb-6">
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium">Şablon Adı</label>
                    <input name="name" value="@nameFilter" class="w-full border border-gray-300 rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block text-sm font-medium">Başlangıç Tarihi</label>
                    <input name="startDate" value="@startDate" type="date" class="w-full border border-gray-300 rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block text-sm font-medium">Bitiş Tarihi</label>
                    <input name="endDate" value="@endDate" type="date" class="w-full border border-gray-300 rounded px-3 py-2" />
                </div>
            </div>

            <div class="grid grid-cols-3 gap-4 items-end">
                <div>
                    <label class="block text-sm font-medium">Sırala</label>
                    <select name="sortField" class="w-full border border-gray-300 rounded px-3 py-2">
                        <option value="">Seçiniz</option>
                        <option value="name" selected="@(sortField == "name")">Ad</option>
                        <option value="pullInterval" selected="@(sortField == "pullInterval")">Çekme Aralığı</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium">Sıralama Yönü</label>
                    <select name="sortDirection" class="w-full border border-gray-300 rounded px-3 py-2">
                        <option value="">Seçiniz</option>
                        <option value="asc" selected="@(sortDirection == "asc")">Artan</option>
                        <option value="desc" selected="@(sortDirection == "desc")">Azalan</option>
                    </select>
                </div>
                <div>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">Filtrele</button>
                </div>
            </div>
        </form>

        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-blue-100">
                    <th class="px-4 py-2 border">Ad</th>
                    <th class="px-4 py-2 border">Endpoint</th>
                    <th class="px-4 py-2 border">Çekme Aralığı</th>
                    <th class="px-4 py-2 border">İşlem</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Items)
                {
                    <tr class="hover:bg-gray-100">
                        <td class="px-4 py-2 border">@item.Name</td>
                        <td class="px-4 py-2 border">@item.OpcEndpoint</td>
                        <td class="px-4 py-2 border">@item.PullInterval sn</td>
                        <td class="px-4 py-2 border">
                            <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700"
                                    onclick="showConfirmPopup('@item.Id', '@item.Name', '@item.OpcEndpoint', '@item.PullInterval')">
                                Rapor Oluştur
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="mt-4 text-sm text-gray-600">
            Toplam: @Model.Items.Count kayıt bulundu.
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function showConfirmPopup(id, name, endpoint, interval) {
            Swal.fire({
                title: 'Bu Şablonla Rapor Oluşturmak İstiyor musunuz?',
                html: `
                    <div class="text-left">
                        <p><strong>Şablon ID:</strong> ${id}</p>
                        <p><strong>Şablon Adı:</strong> ${name}</p>
                        <p><strong>Endpoint:</strong> ${endpoint}</p>
                        <p><strong>Çekme Aralığı:</strong> ${interval} sn</p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Evet, Oluştur',
                cancelButtonText: 'Hayır',
            }).then((result) => {
                if (result.isConfirmed) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/NewReport/CreateFromTemplate';

                    form.innerHTML = `
                        <input type="hidden" name="Id" value="${id}" />
                        <input type="hidden" name="Name" value="${name}" />
                        <input type="hidden" name="OpcEndpoint" value="${endpoint}" />
                        <input type="hidden" name="PullInterval" value="${interval}" />
                    `;

                    document.body.appendChild(form);
                    form.submit();
                }
            });
        }
    </script>
}
