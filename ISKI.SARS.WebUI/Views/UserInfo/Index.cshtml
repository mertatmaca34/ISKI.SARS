@model ISKI.SARS.WebUI.Models.UserInfoViewModel

@{
    ViewData["Title"] = "Kullanıcı Bilgileri";
}

<div class="w-full h-[calc(100vh-64px)] px-10 py-8 bg-[#dcecff]">
    <div class="bg-white p-10 rounded shadow-md w-full max-w-6xl">
        <h2 class="text-3xl font-bold text-blue-700 mb-6 flex items-center gap-2">
            <span>👤</span> Kullanıcı Bilgileri
        </h2>

        @if (TempData["SuccessMessage"] != null)
        {
            <script>window.onload = () => showPopup("@TempData["SuccessMessage"]", false);</script>
        }
        else if (TempData["ErrorMessage"] != null)
        {
            <script>window.onload = () => showPopup("@TempData["ErrorMessage"]", true);</script>
        }

        <form method="post" asp-action="Update" asp-controller="UserInfo" id="userForm">
            <input type="hidden" asp-for="Id" />

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-800">
                <div>
                    <label class="font-semibold block mb-1">Ad:</label>
                    <input asp-for="FirstName" name="FirstName" class="w-full px-3 py-2 border border-gray-300 rounded" readonly />
                </div>
                <div>
                    <label class="font-semibold block mb-1">Soyad:</label>
                    <input asp-for="LastName" name="LastName" class="w-full px-3 py-2 border border-gray-300 rounded" readonly />
                </div>
                <div class="md:col-span-2">
                    <label class="font-semibold block mb-1">Email:</label>
                    <input asp-for="Email" name="Email" class="w-full px-3 py-2 border border-gray-300 rounded" readonly />
                </div>
            </div>

            <div class="mt-8 flex flex-wrap gap-4">
                <a href="/Home/Index" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">← Ana Sayfa</a>

                <button type="button" id="editBtn" class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                    ✏️ Bilgileri Değiştir
                </button>

                <button type="submit" id="saveBtn" class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 hidden" disabled>
                    💾 Kaydet
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        const editBtn = document.getElementById("editBtn");
        const saveBtn = document.getElementById("saveBtn");
        const form = document.getElementById("userForm");
        const formInputs = form.querySelectorAll("input:not([type=hidden])");

        let originalValues = {};

        // 🎯 Edit modunu aç
        editBtn.addEventListener("click", () => {
            formInputs.forEach(input => {
                originalValues[input.name] = input.value;
                input.removeAttribute("readonly");
            });

            editBtn.classList.add("hidden");
            saveBtn.classList.remove("hidden");
            saveBtn.disabled = true;
            saveBtn.classList.add("opacity-50", "cursor-not-allowed");
        });

        // 🔁 Değişiklikleri takip et
        form.addEventListener("input", () => {
            let hasChanges = false;
            formInputs.forEach(input => {
                if (input.value !== originalValues[input.name]) {
                    hasChanges = true;
                }
            });

            saveBtn.disabled = !hasChanges;
            saveBtn.classList.toggle("opacity-50", !hasChanges);
            saveBtn.classList.toggle("cursor-not-allowed", !hasChanges);
        });
    </script>
}

