@model ISKI.SARS.WebUI.Models.LoginViewModel

@{
    Layout = null;
    ViewData["Title"] = "Giriş Yap";
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="min-h-screen flex items-center justify-center bg-blue-50" data-message="@Context.Request.Query["message"]">

    <div class="max-w-md w-full space-y-8">
        <div class="text-center">
            <h1 class="text-5xl font-bold text-blue-700">SARS</h1>
            <p class="mt-2 text-lg text-blue-600">Scada Arşivleme ve Raporlama Sistemi</p>
        </div>

        <form id="loginForm" method="post" class="mt-8 space-y-6" onsubmit="return false;">
            @Html.AntiForgeryToken()

            <div class="space-y-4">
                <input name="Email" placeholder="E-Posta" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500" />
                <input name="Password" type="password" placeholder="Şifre" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500" />
            </div>

            <div class="space-y-4">
                <button type="button" onclick="validateLogin()" class="w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded">
                    Giriş Yap
                </button>

                <p class="text-center text-sm text-gray-600">
                    Hesabınız yok mu? <a href="/Register/Index" class="text-blue-600 hover:underline">Kayıt olun</a>
                </p>
            </div>
        </form>
    </div>

    <script>
        window.onload = () => {
            const message = document.body.dataset.message;
            if (message) {
                showPopup(message);
            }
        }

        function showPopup(message, isError = false) {
            const popup = document.createElement('div');
            popup.className = `fixed top-8 left-1/2 transform -translate-x-1/2 ${isError ? 'bg-red-100 border-red-400 text-red-700' : 'bg-green-100 border-green-400 text-green-700'} border px-4 py-3 rounded shadow-md z-50`;
            popup.innerHTML = `<strong class="font-bold">Bilgilendirme:</strong> <span class="block sm:inline">${message}</span>`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);
        }

        async function validateLogin() {
            const email = document.querySelector('input[name="Email"]').value.trim();
            const password = document.querySelector('input[name="Password"]').value.trim();

            if (!email) return showPopup('Lütfen e-posta adresinizi giriniz.', true);
            if (!password) return showPopup('Lütfen şifrenizi giriniz.', true);

            const response = await fetch("https://localhost:7094/api/Auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ email, password })
            });

            if (response.status === 200) {
                // Giriş başarılı → yönlendirme
                window.location.href = "/Home/Index"; // burayı ihtiyacına göre değiştir
            } else {
                const error = await response.json();
                showPopup(error.message || "Giriş başarısız.", true);
            }
        }
    </script>
</body>
</html>
